<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Favoritos | Mi Tienda</title>
    <meta name="description" content="Tu lista de productos favoritos. Guarda los productos que m√°s te gustan.">

    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg">

    <!-- CSS -->
    <link rel="stylesheet" href="/css/main.css?v=6.5">
    <link rel="stylesheet" href="/css/components/wishlist.css?v=6.5">
    <link rel="stylesheet" href="/css/pages/wishlist.css?v=6.5">
</head>

<body>
    <a href="#main" class="skip-link">Ir al contenido principal</a>

    <!-- Header -->
    <header class="header-container">
        <div class="header-info">
            <p>Env√≠o gratis en compras sobre $50.000 | Lunes a Viernes 9:00 - 18:00hrs</p>
        </div>

        <nav class="header-nav">
            <div class="container">
                <button class="menu-toggle" aria-label="Men√∫">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <line x1="3" y1="18" x2="21" y2="18" />
                    </svg>
                </button>

                <a href="/home.html" class="header-logo">MT</a>

                <ul class="nav-links">
                    <li><a href="/home.html">Inicio</a></li>
                    <li><a href="productos.html">Productos</a></li>
                    <li><a href="nosotros.html">Nosotros</a></li>
                    <li><a href="contacto.html">Contacto</a></li>
                </ul>

                <div class="header-search">
                    <button class="search-icon" aria-label="Buscar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8" />
                            <line x1="21" y1="21" x2="16.65" y2="16.65" />
                        </svg>
                    </button>
                    <input type="text" placeholder="Buscar productos...">
                </div>

                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle" aria-label="Cambiar tema">
                        <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>

                    <a href="wishlist.html" class="wishlist-header-btn active" aria-label="Favoritos">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
                        </svg>
                        <span class="wishlist-count" style="display:none;">0</span>
                    </a>

                    <a href="carrito.html" class="cart-btn" aria-label="Carrito">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1" />
                            <circle cx="20" cy="21" r="1" />
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />
                        </svg>
                        <span class="cart-count" id="cartCount" style="display:none;">0</span>
                    </a>

                    <a href="login.html" class="user-btn" aria-label="Usuario">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <span>Men√∫</span>
            <button class="mobile-close" aria-label="Cerrar">&times;</button>
        </div>
        <nav class="mobile-nav">
            <a href="/home.html">Inicio</a>
            <a href="productos.html">Productos</a>
            <a href="nosotros.html">Nosotros</a>
            <a href="contacto.html">Contacto</a>
            <a href="login.html">Ingresar</a>
        </nav>
    </div>
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Main Content -->
    <main id="main" class="wishlist-main">
        <div class="container">
            <!-- Page Header -->
            <div class="wishlist-page-header">
                <div class="wishlist-title-section">
                    <h1>
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
                        </svg>
                        Mis Favoritos
                        <span class="wishlist-total-badge" id="wishlistBadge">(0)</span>
                    </h1>
                </div>
                <div class="wishlist-actions">
                    <button class="btn-action" id="shareWishlistBtn" title="Compartir lista">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="18" cy="5" r="3" />
                            <circle cx="6" cy="12" r="3" />
                            <circle cx="18" cy="19" r="3" />
                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
                        </svg>
                        <span>Compartir</span>
                    </button>
                    <button class="btn-action btn-danger" id="clearWishlistBtn" title="Vaciar lista">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6" />
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                        </svg>
                        <span>Vaciar</span>
                    </button>
                </div>
            </div>

            <!-- Wishlist Content -->
            <div class="wishlist-content" id="wishlistContainer">
                <!-- Dynamic content rendered by JS -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer" id="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section footer-about">
                    <div class="footer-logo">
                        <span class="footer-logo-text">MT</span>
                        <h3>Mi Tienda</h3>
                    </div>
                    <p class="footer-description">Tu tienda online de confianza con los mejores productos.</p>
                </div>

                <div class="footer-section footer-links">
                    <h4 class="footer-title">Enlaces</h4>
                    <ul>
                        <li><a href="/home.html">Inicio</a></li>
                        <li><a href="productos.html">Productos</a></li>
                        <li><a href="nosotros.html">Nosotros</a></li>
                        <li><a href="contacto.html">Contacto</a></li>
                    </ul>
                </div>

                <div class="footer-section footer-contact">
                    <h4 class="footer-title">Contacto</h4>
                    <ul>
                        <li>üìç Av. Providencia 1234, Santiago</li>
                        <li>üìû +56 9 1234 5678</li>
                        <li>‚úâÔ∏è contacto@mitienda.cl</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Mi Tienda. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/js/config.js?v=6.5"></script>
    <script src="/js/utils.js?v=6.5"></script>
    <script src="/js/auth.js?v=6.5" defer></script>
    <script src="/js/cart.js?v=6.5"></script>
    <script src="/js/api.js?v=6.5"></script>
    <script src="/js/header.js?v=6.5" defer></script>
    <script src="/js/wishlist.js?v=6.5"></script>
    <script src="/js/script.js?v=6.5"></script>

    <script>
        // Page-specific wishlist rendering
        document.addEventListener('DOMContentLoaded', () => {
            renderWishlistPageEnhanced();
            initWishlistActions();
        });

        function renderWishlistPageEnhanced() {
            const container = document.getElementById('wishlistContainer');
            const badge = document.getElementById('wishlistBadge');
            if (!container) return;

            const items = wishlist.getAll().filter(item => item !== null && item !== undefined);

            // Update badge
            if (badge) badge.textContent = `(${items.length})`;

            // Toggle action buttons visibility
            const actionsContainer = document.querySelector('.wishlist-actions');
            if (actionsContainer) {
                actionsContainer.style.display = items.length > 0 ? 'flex' : 'none';
            }

            if (items.length === 0) {
                container.innerHTML = `
                    <div class="wishlist-empty">
                        <div class="empty-icon">
                            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                            </svg>
                        </div>
                        <h2>Tu lista de favoritos est√° vac√≠a</h2>
                        <p>Explora nuestros productos y guarda los que m√°s te gusten</p>
                        <a href="productos.html" class="btn btn-primary">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="9" cy="21" r="1"/>
                                <circle cx="20" cy="21" r="1"/>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                            </svg>
                            Explorar Productos
                        </a>
                    </div>
                `;
                return;
            }

            // Render items in list view
            container.innerHTML = `
                <div class="wishlist-list">
                    ${items.map(item => createWishlistItemEnhanced(item)).join('')}
                </div>
            `;

            // Add event listeners
            attachWishlistItemListeners();
        }

        function createWishlistItemEnhanced(item) {
            if (!item) return '';

            const id = item.id || item.product_id;
            const nombre = item.nombre || item.name || 'Producto';
            const precio = item.precio || item.price || 0;
            const precioOriginal = item.precioOriginal;
            const imagen = item.imagen || item.image || item.image_url || '/images/products/placeholder.png';
            const marca = item.marca || '';
            const categoria = item.categoria || '';
            const descuento = item.descuento;
            const addedAt = item.addedAt ? formatTimeAgo(new Date(item.addedAt)) : '';

            const formatPrice = (p) => '$' + p.toLocaleString('es-CL');

            return `
                <div class="wishlist-item" data-id="${id}">
                    <div class="wishlist-item-image" onclick="window.location.href='producto.html?id=${id}'">
                        <img src="${imagen}" alt="${nombre}" loading="lazy">
                        ${descuento ? `<span class="discount-badge">-${descuento}%</span>` : ''}
                    </div>
                    <div class="wishlist-item-details">
                        <div class="item-meta">
                            ${marca ? `<span class="item-brand">${marca}</span>` : ''}
                            ${categoria ? `<span class="item-category">${categoria}</span>` : ''}
                        </div>
                        <h3 class="item-name" onclick="window.location.href='producto.html?id=${id}'">${nombre}</h3>
                        ${addedAt ? `<span class="item-date">Agregado ${addedAt}</span>` : ''}
                    </div>
                    <div class="wishlist-item-price">
                        <span class="price-current">${formatPrice(precio)}</span>
                        ${precioOriginal ? `<span class="price-original">${formatPrice(precioOriginal)}</span>` : ''}
                    </div>
                    <div class="wishlist-item-actions">
                        <button class="btn-add-cart" data-id="${id}" title="Agregar al carrito">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="9" cy="21" r="1"/>
                                <circle cx="20" cy="21" r="1"/>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                            </svg>
                            <span>Agregar</span>
                        </button>
                        <button class="btn-remove" data-id="${id}" title="Eliminar de favoritos">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
        }

        function formatTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));

            if (days === 0) return 'hoy';
            if (days === 1) return 'ayer';
            if (days < 7) return `hace ${days} d√≠as`;
            if (days < 30) return `hace ${Math.floor(days / 7)} semana${Math.floor(days / 7) > 1 ? 's' : ''}`;
            return `hace ${Math.floor(days / 30)} mes${Math.floor(days / 30) > 1 ? 'es' : ''}`;
        }

        function attachWishlistItemListeners() {
            // Add to cart buttons
            document.querySelectorAll('.btn-add-cart').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = btn.dataset.id;
                    const item = wishlist.getAll().find(i => String(i.id) === String(id));

                    if (item && typeof cart !== 'undefined') {
                        cart.add({
                            product_id: item.id || item.product_id,
                            name: item.nombre || item.name,
                            price: item.precio || item.price,
                            image_url: item.imagen || item.image || item.image_url
                        }, 1);
                        showWishlistNotification('Agregado al carrito');

                        // Animate button
                        btn.classList.add('added');
                        setTimeout(() => btn.classList.remove('added'), 1000);
                    }
                });
            });

            // Remove buttons
            document.querySelectorAll('.btn-remove').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = btn.dataset.id;
                    const itemEl = btn.closest('.wishlist-item');

                    // Animate removal
                    itemEl.classList.add('removing');
                    setTimeout(() => {
                        wishlist.remove(id);
                        renderWishlistPageEnhanced();
                        showWishlistNotification('Eliminado de favoritos');
                    }, 300);
                });
            });
        }

        function initWishlistActions() {
            // Share button
            document.getElementById('shareWishlistBtn')?.addEventListener('click', async () => {
                const items = wishlist.getAll();
                if (items.length === 0) {
                    showWishlistNotification('Tu lista est√° vac√≠a');
                    return;
                }

                const text = `Mi lista de favoritos:\n${items.map(item => `‚Ä¢ ${item.nombre || item.name}`).join('\n')}`;

                try {
                    if (navigator.share) {
                        await navigator.share({
                            title: 'Mi Lista de Favoritos',
                            text: text,
                            url: window.location.href
                        });
                    } else {
                        await navigator.clipboard.writeText(text);
                        showWishlistNotification('Lista copiada al portapapeles');
                    }
                } catch (err) {
                    console.log('Share cancelled');
                }
            });

            // Clear all button
            document.getElementById('clearWishlistBtn')?.addEventListener('click', () => {
                if (wishlist.getCount() === 0) return;

                if (confirm('¬øEst√°s seguro de vaciar tu lista de favoritos?')) {
                    wishlist.clear();
                    renderWishlistPageEnhanced();
                    showWishlistNotification('Lista vaciada');
                }
            });

            // Listen for wishlist updates
            window.addEventListener('wishlistUpdated', renderWishlistPageEnhanced);
        }
    </script>
</body>

</html>