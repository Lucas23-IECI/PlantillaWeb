<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión | Mi Tienda</title>
    <meta name="description" content="Inicia sesión en tu cuenta de Mi Tienda.">
    <link rel="icon" type="image/svg+xml" href="../images/favicon.svg">
    <link rel="stylesheet" href="../css/main.css?v=3.0">
</head>

<body>
    <!-- Header Component -->
    <header class="header-container">
        <!-- Info Banner -->
        <div class="header-info">
            <p>Envío gratis en compras sobre $50.000 | Lunes a Viernes 9:00 - 18:00hrs</p>
        </div>

        <!-- Navbar -->
        <nav class="header-nav">
            <div class="container">
                <button class="menu-toggle" aria-label="Menú">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <line x1="3" y1="18" x2="21" y2="18" />
                    </svg>
                </button>

                <a href="../home.html" class="header-logo">MT</a>

                <ul class="nav-links">
                    <li><a href="../home.html">Inicio</a></li>
                    <li><a href="productos.html">Productos</a></li>
                    <li><a href="nosotros.html">Nosotros</a></li>
                    <li><a href="contacto.html">Contacto</a></li>
                </ul>

                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle" aria-label="Cambiar tema">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5" />
                            <line x1="12" y1="1" x2="12" y2="3" />
                            <line x1="12" y1="21" x2="12" y2="23" />
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                            <line x1="1" y1="12" x2="3" y2="12" />
                            <line x1="21" y1="12" x2="23" y2="12" />
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                        </svg>
                    </button>

                    <a href="carrito.html" class="cart-btn" aria-label="Carrito">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1" />
                            <circle cx="20" cy="21" r="1" />
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />
                        </svg>
                        <span class="cart-count" id="cartCount" style="display:none;">0</span>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <span>Menú</span>
            <button class="mobile-close" aria-label="Cerrar">&times;</button>
        </div>
        <nav class="mobile-nav">
            <a href="../home.html">Inicio</a>
            <a href="productos.html">Productos</a>
            <a href="nosotros.html">Nosotros</a>
            <a href="contacto.html">Contacto</a>
        </nav>
    </div>
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Main Content -->
    <main id="main">
        <section class="section">
            <div class="container" style="display: flex; justify-content: center; min-height: 60vh; align-items: center;">
                <div class="auth-card"
                    style="width: 100%; max-width: 400px; background: var(--color-surface); padding: var(--spacing-2xl); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg);">
                    <h1 style="text-align: center; font-size: var(--font-size-2xl); margin-bottom: var(--spacing-xl);">Iniciar Sesión</h1>

                    <form id="loginForm">
                        <div class="form-group">
                            <label class="form-label" for="email">Email</label>
                            <input type="email" class="form-input" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="password">Contraseña</label>
                            <input type="password" class="form-input" id="password" name="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">Ingresar</button>
                    </form>

                    <div style="text-align: center; margin-top: var(--spacing-lg); font-size: var(--font-size-sm);">
                        <p>¿No tienes cuenta? <a href="registro.html" style="color: var(--color-accent);">Regístrate</a></p>
                        <p style="margin-top: var(--spacing-sm);"><a href="recuperar-password.html" style="color: var(--color-text-muted);">¿Olvidaste tu contraseña?</a></p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2025 Mi Tienda. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="../js/config.js?v=3.0"></script>
    <script src="../js/utils.js?v=3.0"></script>
    <script src="../js/auth.js?v=3.0"></script>
    <script src="../js/cart.js?v=3.0"></script>
    <script src="../js/api.js?v=3.0"></script>
    <script src="../js/header.js?v=3.0"></script>
    <script>
        // Redirigir si ya está logueado
        if (isLoggedIn()) {
            window.location.href = 'cuenta.html';
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const result = await api.login(email, password);
                saveAuthSession(result.token, result.user);
                if (typeof showNotification === 'function') {
                    showNotification('¡Bienvenido!', 'success');
                }
                setTimeout(() => {
                    window.location.href = result.user.admin ? 'admin.html' : 'cuenta.html';
                }, 500);
            } catch (error) {
                if (typeof showNotification === 'function') {
                    showNotification(error.message || 'Error al iniciar sesión', 'error');
                } else {
                    alert(error.message || 'Error al iniciar sesión');
                }
            }
        });
    </script>
</body>

</html>