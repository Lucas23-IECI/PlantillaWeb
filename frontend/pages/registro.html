<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Cuenta | Mi Tienda</title>
    <meta name="description" content="Crea tu cuenta en Mi Tienda.">
    <link rel="icon" type="image/svg+xml" href="../images/favicon.svg">
    <link rel="stylesheet" href="../css/main.css?v=3.0">
</head>

<body>
    <!-- Header Component -->
    <header class="header-container">
        <!-- Info Banner -->
        <div class="header-info">
            <p>Envío gratis en compras sobre $50.000 | Lunes a Viernes 9:00 - 18:00hrs</p>
        </div>

        <!-- Navbar -->
        <nav class="header-nav">
            <div class="container">
                <button class="menu-toggle" aria-label="Menú">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <line x1="3" y1="18" x2="21" y2="18" />
                    </svg>
                </button>

                <a href="../home.html" class="header-logo">MT</a>

                <ul class="nav-links">
                    <li><a href="../home.html">Inicio</a></li>
                    <li><a href="productos.html">Productos</a></li>
                    <li><a href="nosotros.html">Nosotros</a></li>
                    <li><a href="contacto.html">Contacto</a></li>
                </ul>

                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle" aria-label="Cambiar tema">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5" />
                            <line x1="12" y1="1" x2="12" y2="3" />
                            <line x1="12" y1="21" x2="12" y2="23" />
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                            <line x1="1" y1="12" x2="3" y2="12" />
                            <line x1="21" y1="12" x2="23" y2="12" />
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                        </svg>
                    </button>

                    <a href="carrito.html" class="cart-btn" aria-label="Carrito">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1" />
                            <circle cx="20" cy="21" r="1" />
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />
                        </svg>
                        <span class="cart-count" id="cartCount" style="display:none;">0</span>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <span>Menú</span>
            <button class="mobile-close" aria-label="Cerrar">&times;</button>
        </div>
        <nav class="mobile-nav">
            <a href="../home.html">Inicio</a>
            <a href="productos.html">Productos</a>
            <a href="nosotros.html">Nosotros</a>
            <a href="contacto.html">Contacto</a>
        </nav>
    </div>
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Main Content -->
    <main id="main">
        <section class="section">
            <div class="container" style="display: flex; justify-content: center; min-height: 70vh; align-items: center; padding: var(--spacing-2xl) 0;">
                <div class="auth-card"
                    style="width: 100%; max-width: 450px; background: var(--color-surface); padding: var(--spacing-2xl); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg);">
                    <h1 style="text-align: center; font-size: var(--font-size-2xl); margin-bottom: var(--spacing-xl);">Crear Cuenta</h1>

                    <form id="registerForm">
                        <div class="form-group">
                            <label class="form-label" for="name">Nombre completo *</label>
                            <input type="text" class="form-input" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="email">Email *</label>
                            <input type="email" class="form-input" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="phone">Teléfono</label>
                            <input type="tel" class="form-input" id="phone" name="phone" placeholder="+56 9 1234 5678">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                            <div class="form-group">
                                <label class="form-label" for="password">Contraseña *</label>
                                <input type="password" class="form-input" id="password" name="password" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="password2">Confirmar *</label>
                                <input type="password" class="form-input" id="password2" name="password2" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">Crear Cuenta</button>
                    </form>

                    <div style="text-align: center; margin-top: var(--spacing-lg); font-size: var(--font-size-sm);">
                        <p>¿Ya tienes cuenta? <a href="login.html" style="color: var(--color-accent);">Inicia sesión</a></p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2025 Mi Tienda. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="../js/config.js?v=3.0"></script>
    <script src="../js/utils.js?v=3.0"></script>
    <script src="../js/auth.js?v=3.0"></script>
    <script src="../js/cart.js?v=3.0"></script>
    <script src="../js/api.js?v=3.0"></script>
    <script src="../js/header.js?v=3.0"></script>
    <script>
        // Obtener URL de redirección si existe
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect') || '../home.html';

        if (isLoggedIn()) {
            window.location.href = redirectUrl;
        }

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'Creando cuenta...';

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            const password2 = document.getElementById('password2').value;

            if (password !== password2) {
                btn.disabled = false;
                btn.textContent = originalText;
                if (typeof showNotification === 'function') {
                    showNotification('Las contraseñas no coinciden', 'error');
                } else {
                    alert('Las contraseñas no coinciden');
                }
                return;
            }

            if (password.length < 6) {
                btn.disabled = false;
                btn.textContent = originalText;
                if (typeof showNotification === 'function') {
                    showNotification('La contraseña debe tener al menos 6 caracteres', 'error');
                } else {
                    alert('La contraseña debe tener al menos 6 caracteres');
                }
                return;
            }

            try {
                const result = await api.register(email, name, password, phone);
                saveAuthSession(result.token, result.user);
                if (typeof showNotification === 'function') {
                    showNotification('¡Cuenta creada exitosamente!', 'success');
                }
                // Redirigir al home después de registrarse
                setTimeout(() => {
                    window.location.href = redirectUrl;
                }, 500);
            } catch (error) {
                btn.disabled = false;
                btn.textContent = originalText;
                if (typeof showNotification === 'function') {
                    showNotification(error.message || 'Error al crear cuenta', 'error');
                } else {
                    alert(error.message || 'Error al crear cuenta');
                }
            }
        });
    </script>
</body>

</html>